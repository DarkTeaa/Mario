<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ç–µ—Å—Ç–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1, h2 { text-align: center; color: #2c3e50; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #2980b9; }
        .login-btn { background: #9b59b6; }
        .logout-btn { background: #e74c3c; }
        .create-btn { background: #27ae60; margin-bottom: 20px; }
        .import-btn { background: #f39c12; margin-bottom: 20px; }
        .delete-test-btn { 
            background: #e74c3c; 
            padding: 8px 16px;
            font-size: 14px;
            margin-left: 10px;
        }
        .edit-test-btn {
            background: #3498db;
            padding: 8px 16px;
            font-size: 14px;
            margin-left: 10px;
        }
        .no-tests {
            text-align: center;
            font-size: 24px;
            color: #7f8c8d;
            margin: 80px 0;
        }
        .test-list { margin-top: 20px; }
        .test-card {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
        }
        .test-card h3 { margin: 0 0 10px 0; }
        .test-card p { margin: 5px 0; }
        .start-test {
            background: #3498db;
            padding: 8px 16px;
        }
        .test-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .answer-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #f9f9f9;
            position: relative;
        }
        .answer-item img.preview {
            max-width: 300px;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
            display: block;
        }
        .remove-img {
            background: #e74c3c;
            padding: 5px 10px;
            font-size: 12px;
            margin-top: 10px;
        }
        .remove-answer {
            background: #e74c3c;
            padding: 5px 10px;
            font-size: 12px;
            position: absolute;
            right: 10px;
            top: 10px;
        }
        .remove-question {
            background: #e74c3c;
            padding: 5px 10px;
            font-size: 12px;
            margin-top: 10px;
        }
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        .quiz-question { margin-bottom: 40px; }
        .quiz-options label {
            display: block;
            margin: 15px 0;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            border: 2px solid transparent;
        }
        .quiz-options label:hover { background: #d6dbdf; }
        .quiz-options input[type="radio"] { margin-right: 10px; }
        .quiz-options img {
            max-width: 300px;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
            display: block;
        }
        .result { text-align: center; font-size: 24px; margin: 40px 0; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ */
        .correct-answer {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
            border: 2px solid #28a745 !important;
        }
        .wrong-answer {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
            border: 2px solid #dc3545 !important;
        }
        .show-correct {
            animation: pulse 1.5s;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞–º–∏ */
        .answer-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .add-answer-btn {
            background: #27ae60;
            padding: 8px 15px;
            font-size: 14px;
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .question-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ */
        .delete-confirm {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
        }
        .delete-confirm h3 {
            margin-top: 0;
            color: #e74c3c;
        }
        .delete-confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .confirm-delete-btn {
            background: #e74c3c;
        }
        .cancel-delete-btn {
            background: #95a5a6;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π —Ñ–∞–π–ª–æ–≤ */
        .file-input-wrapper {
            margin-top: 10px;
        }
        .file-input-wrapper input[type="file"] {
            padding: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ç–µ—Å—Ç–æ–≤</h1>
            <div id="auth-buttons">
                <button class="login-btn" onclick="showLogin()">–í–æ–π—Ç–∏ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤)</button>
            </div>
        </div>

        <div id="admin-panel" style="display: none;">
            <button class="create-btn" onclick="showCreateForm()">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ—Å—Ç</button>
            <button class="import-btn" onclick="refreshTestsFromGitHub()">–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã —Å GitHub</button>
            <button class="import-btn" onclick="document.getElementById('import-file-input').click()" style="background: #95a5a6;">–ò–º–ø–æ—Ä—Ç (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)</button>
            <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
            <hr style="margin: 20px 0;">
        </div>

        <div class="no-tests" id="no-tests-msg">–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è —Ç–µ—Å—Ç—ã</div>

        <div id="test-list" class="test-list"></div>

        <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–∞ -->
        <input type="file" id="import-file-input" accept=".json" style="display: none;" onchange="importTestsFromFile(event)">

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
        <div id="login-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 100;">
            <div style="background: white; padding: 30px; border-radius: 10px; width: 300px;">
                <h2>–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω"><br><br>
                <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>
                <p style="color: gray; font-size: 14px;">–õ–æ–≥–∏–Ω: admin<br>–ü–∞—Ä–æ–ª—å: test123</p>
                <button onclick="login()">–í–æ–π—Ç–∏</button>
                <button onclick="hideLogin()" style="background: #95a5a6;">–û—Ç–º–µ–Ω–∞</button>
                <p id="login-error" style="color: red; display: none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</p>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ -->
        <div id="create-form" style="display: none; margin-top: 30px;">
            <h2 id="create-form-title">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞</h2>
            <input type="text" id="test-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞">

            <div id="questions-container"></div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="addQuestion()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                <button onclick="saveTest()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç</button>
                <button onclick="cancelCreate()" style="background: #95a5a6;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ -->
        <div id="quiz-section" style="display: none; margin-top: 30px;"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="delete-confirm-modal" style="display: none;">
        <div class="overlay"></div>
        <div class="delete-confirm">
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ—Å—Ç?</p>
            <p id="test-to-delete-name" style="font-weight: bold; color: #2c3e50;"></p>
            <div class="delete-confirm-buttons">
                <button class="confirm-delete-btn" onclick="confirmDeleteTest()">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
                <button class="cancel-delete-btn" onclick="cancelDeleteTest()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_LOGIN = 'admin';
        const ADMIN_PASS = 'test123';
        let isLoggedIn = false;
        let testToDeleteIndex = null;
        let testToEditIndex = null; // –ò–Ω–¥–µ–∫—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ —Ç–µ—Å—Ç–∞ (null = —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ)
        let tests = []; // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ —Ç–µ—Å—Ç–æ–≤
        
        // URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ tests.json —Å GitHub
        // –î–ª—è GitHub Pages —Ñ–∞–π–ª tests.json –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ index.html
        function getTestsJsonUrl() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å - —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ tests.json –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ –∏–ª–∏ –≤ –∫–æ—Ä–Ω–µ
            return 'tests.json';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ tests.json —Å GitHub –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        async function loadTestsFromFile() {
            try {
                const url = getTestsJsonUrl();
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏–∑:', url);
                
                const response = await fetch(url, {
                    cache: 'no-cache', // –û–±—Ö–æ–¥–∏–º –∫–µ—à, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (response.ok) {
                    const loadedTests = await response.json();
                    if (Array.isArray(loadedTests)) {
                        tests = loadedTests;
                        console.log('–¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub:', tests.length);
                    } else {
                        console.warn('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ tests.json');
                    }
                } else {
                    console.warn('–§–∞–π–ª tests.json –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:', url);
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ tests.json —Å GitHub:', err.message);
            } finally {
                loadTests(); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ—Å—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            }
        }

        // –ò–º–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
        function importTestsFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ input, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª —Å–Ω–æ–≤–∞
            event.target.value = '';

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedTests = JSON.parse(e.target.result);
                    if (Array.isArray(importedTests)) {
                        // –í–ê–ñ–ù–û: –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–µ—Å—Ç—ã –∏ –∑–∞–º–µ–Ω—è–µ–º –∏—Ö –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
                        tests = importedTests;
                        loadTests();
                        
                        // –°–∫–∞—á–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
                        saveTestsToFile();
                        
                        alert(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${tests.length} —Ç–µ—Å—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞! –§–∞–π–ª –±—É–¥–µ—Ç —Å–∫–∞—á–∞–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ GitHub.`);
                    } else {
                        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤ —Ç–µ—Å—Ç–æ–≤.');
                    }
                } catch (err) {
                    alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON.');
                }
            };
            reader.readAsText(file);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ —Å GitHub (–∫–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
        async function refreshTestsFromGitHub() {
            await loadTestsFromFile();
            alert('–¢–µ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å GitHub!');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª tests.json (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)
        function saveTestsToFile() {
            const dataStr = JSON.stringify(tests, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});

            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = 'tests.json';
            downloadLink.style.display = 'none';

            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);

            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
            setTimeout(() => URL.revokeObjectURL(downloadLink.href), 100);
            
            console.log('–¢–µ—Å—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª tests.json');
        }

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç—ã —Å GitHub
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('isAdminLoggedIn') === 'true') {
                loginSuccess();
            }
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç—ã —Å GitHub –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            loadTestsFromFile();
        });

        function showLogin() {
            document.getElementById('login-modal').style.display = 'flex';
        }

        function hideLogin() {
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('login-error').style.display = 'none';
        }

        function login() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value;

            if (user === ADMIN_LOGIN && pass === ADMIN_PASS) {
                loginSuccess();
                hideLogin();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }

        function loginSuccess() {
            isLoggedIn = true;
            localStorage.setItem('isAdminLoggedIn', 'true');
            document.getElementById('auth-buttons').innerHTML = `<button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>`;
            document.getElementById('admin-panel').style.display = 'block';
            loadTests();
        }

        function logout() {
            isLoggedIn = false;
            localStorage.removeItem('isAdminLoggedIn');
            document.getElementById('auth-buttons').innerHTML = `<button class="login-btn" onclick="showLogin()">–í–æ–π—Ç–∏ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤)</button>`;
            document.getElementById('admin-panel').style.display = 'none';
            loadTests();
        }

        function createQuestionBlock(questionIndex = 0) {
            const block = document.createElement('div');
            block.className = 'question-block';
            block.style = 'border: 1px solid #ccc; padding: 20px; margin: 20px 0; border-radius: 8px; background: #f8f9fa;';
            block.dataset.index = questionIndex;

            block.innerHTML = `
                <div class="question-header">
                    <div class="question-title">–í–æ–ø—Ä–æ—Å ${questionIndex + 1}</div>
                    <button class="remove-question" onclick="removeQuestion(this)" type="button">–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                </div>
                <input type="text" class="question-text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞">

                <div class="answers-container"></div>

                <div class="answer-controls">
                    <button class="add-answer-btn" onclick="addAnswer(this)" type="button">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞</button>
                </div>

                <div style="margin-top: 15px;">
                    <label><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong>
                    <select class="correct-answer">
                        <option value="0">–í–∞—Ä–∏–∞–Ω—Ç 1</option>
                    </select>
                    </label>
                </div>
            `;

            const answersContainer = block.querySelector('.answers-container');
            
            for (let i = 0; i < 4; i++) {
                addAnswerToContainer(answersContainer, i);
            }

            updateCorrectAnswerSelect(block);

            return block;
        }

        function addAnswerToContainer(container, answerIndex) {
            const answerDiv = document.createElement('div');
            answerDiv.className = 'answer-item';
            answerDiv.dataset.index = answerIndex;
            
            answerDiv.innerHTML = `
                <input type="text" class="answer-text" placeholder="–¢–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞">
                <button class="remove-answer" onclick="removeAnswer(this)" type="button">–£–¥–∞–ª–∏—Ç—å</button>
                <div class="file-input-wrapper">
                    <input type="file" class="answer-image-file" accept="image/*">
                    <img class="preview" style="display:none;">
                    <button class="remove-img" style="display:none;" onclick="removeImage(this)" type="button">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                </div>
            `;

            const input = answerDiv.querySelector('.answer-image-file');
            input.addEventListener('change', function() {
                handleImageUpload(this);
            });

            container.appendChild(answerDiv);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
            updateRemoveAnswerButtons(container);
        }

        function handleImageUpload(input) {
            const file = input.files[0];
            const preview = input.parentElement.querySelector('.preview');
            const removeBtn = input.parentElement.querySelector('.remove-img');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    removeBtn.style.display = 'inline-block';
                };
                reader.readAsDataURL(file);
            }
        }

        function removeImage(btn) {
            const item = btn.parentElement;
            const input = item.querySelector('.answer-image-file');
            const preview = item.querySelector('.preview');
            const removeBtn = btn;

            input.value = '';
            preview.src = '';
            preview.style.display = 'none';
            removeBtn.style.display = 'none';
        }

        function addAnswer(btn) {
            const container = btn.closest('.question-block').querySelector('.answers-container');
            const answerIndex = container.children.length;
            addAnswerToContainer(container, answerIndex);
            updateCorrectAnswerSelect(btn.closest('.question-block'));
            updateRemoveAnswerButtons(container);
        }

        function removeAnswer(btn) {
            const answerItem = btn.closest('.answer-item');
            const container = answerItem.parentElement;
            
            if (container.children.length > 2) {
                container.removeChild(answerItem);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã
                Array.from(container.children).forEach((item, index) => {
                    item.dataset.index = index;
                });
                
                updateCorrectAnswerSelect(btn.closest('.question-block'));
                updateRemoveAnswerButtons(container);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
        function updateRemoveAnswerButtons(container) {
            const removeButtons = container.querySelectorAll('.remove-answer');
            const shouldDisable = container.children.length <= 2;
            
            removeButtons.forEach(btn => {
                btn.disabled = shouldDisable;
                btn.style.opacity = shouldDisable ? '0.5' : '1';
                btn.style.cursor = shouldDisable ? 'not-allowed' : 'pointer';
            });
        }

        function removeQuestion(btn) {
            const questionBlock = btn.closest('.question-block');
            const container = document.getElementById('questions-container');
            
            if (container.children.length > 1) {
                container.removeChild(questionBlock);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
                Array.from(container.children).forEach((block, index) => {
                    block.dataset.index = index;
                    block.querySelector('.question-title').textContent = `–í–æ–ø—Ä–æ—Å ${index + 1}`;
                });
            } else {
                alert('–î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å!');
            }
        }

        function updateCorrectAnswerSelect(questionBlock) {
            const select = questionBlock.querySelector('.correct-answer');
            const container = questionBlock.querySelector('.answers-container');
            const currentValue = select.value;
            
            select.innerHTML = '';
            
            Array.from(container.children).forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `–í–∞—Ä–∏–∞–Ω—Ç ${index + 1}`;
                select.appendChild(option);
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –≤–∞–ª–∏–¥–Ω–æ
            if (currentValue < container.children.length) {
                select.value = currentValue;
            } else {
                select.value = container.children.length - 1;
            }
        }

        function showCreateForm() {
            testToEditIndex = null;
            document.getElementById('create-form').style.display = 'block';
            document.getElementById('create-form-title').textContent = '–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞';
            document.getElementById('test-list').style.display = 'none';
            document.getElementById('no-tests-msg').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'none';

            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            container.appendChild(createQuestionBlock(0));
            document.getElementById('test-title').value = '';
        }

        function addQuestion() {
            const container = document.getElementById('questions-container');
            const questionIndex = container.children.length;
            container.appendChild(createQuestionBlock(questionIndex));
        }

        function cancelCreate() {
            hideCreateForm();
            if (isLoggedIn) {
                document.getElementById('admin-panel').style.display = 'block';
            }
        }

        function hideCreateForm() {
            document.getElementById('create-form').style.display = 'none';
            document.getElementById('test-title').value = '';
            document.getElementById('questions-container').innerHTML = '';
            showMainPage();
        }

        function showMainPage() {
            document.getElementById('test-list').style.display = 'block';
            if (isLoggedIn) {
                document.getElementById('admin-panel').style.display = 'block';
            }
            loadTests();
        }

        function saveTest() {
            const title = document.getElementById('test-title').value.trim();
            if (!title) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞!');

            const questions = [];
            const blocks = document.querySelectorAll('.question-block');

            for (let block of blocks) {
                const qText = block.querySelector('.question-text').value.trim();
                if (!qText) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤!');

                const answerItems = block.querySelectorAll('.answer-item');
                const answers = [];

                for (let item of answerItems) {
                    const text = item.querySelector('.answer-text').value.trim();
                    const preview = item.querySelector('.preview');

                    if (text) {
                        answers.push({
                            text,
                            image: preview.src && preview.style.display !== 'none' ? preview.src : null
                        });
                    }
                }

                if (answers.length < 2) return alert('–£ –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º!');

                const correct = parseInt(block.querySelector('.correct-answer').value);

                questions.push({ text: qText, answers, correct });
            }

            if (questions.length === 0) return alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å!');

            if (testToEditIndex !== null) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞
                tests[testToEditIndex] = { title, questions };
                alert('–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } else {
                // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
                tests.push({ title, questions });
                alert('–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            }

            saveTestsToFile();
            hideCreateForm();
        }

        function loadTests() {
            const list = document.getElementById('test-list');
            list.innerHTML = '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç—ã –∏–∑ tests.json –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Å—Å–∏–∏
            if (tests.length === 0) {
                document.getElementById('no-tests-msg').style.display = 'block';
                return;
            }

            document.getElementById('no-tests-msg').style.display = 'none';

            tests.forEach((test, index) => {
                const card = document.createElement('div');
                card.className = 'test-card';
                
                let cardContent = `
                    <h3>${test.title}</h3>
                    <p>–í–æ–ø—Ä–æ—Å–æ–≤: ${test.questions.length}</p>
                    <div class="test-actions">
                        <button class="start-test" onclick="startTest(${index})">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
                `;
                
                if (isLoggedIn) {
                    cardContent += `<button class="edit-test-btn" onclick="editTest(${index})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç</button>`;
                    cardContent += `<button class="delete-test-btn" onclick="showDeleteConfirm(${index})">–£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç</button>`;
                }
                
                cardContent += `</div>`;
                card.innerHTML = cardContent;
                list.appendChild(card);
            });
        }

        function showDeleteConfirm(index) {
            if (index >= 0 && index < tests.length) {
                testToDeleteIndex = index;
                document.getElementById('test-to-delete-name').textContent = tests[index].title;
                document.getElementById('delete-confirm-modal').style.display = 'block';
            }
        }

        function cancelDeleteTest() {
            testToDeleteIndex = null;
            document.getElementById('delete-confirm-modal').style.display = 'none';
        }

        function confirmDeleteTest() {
            if (testToDeleteIndex !== null) {
                tests.splice(testToDeleteIndex, 1);
                saveTestsToFile();
                loadTests();
            }
            cancelDeleteTest();
        }

        function editTest(index) {
            if (index < 0 || index >= tests.length) {
                alert('–¢–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            testToEditIndex = index;
            const test = tests[index];
            
            document.getElementById('create-form').style.display = 'block';
            document.getElementById('create-form-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞';
            document.getElementById('test-list').style.display = 'none';
            document.getElementById('no-tests-msg').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'none';
            
            document.getElementById('test-title').value = test.title;
            
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            test.questions.forEach((question, qIndex) => {
                const block = createQuestionBlock(qIndex);
                block.querySelector('.question-text').value = question.text;
                block.querySelector('.correct-answer').value = question.correct;
                
                const answersContainer = block.querySelector('.answers-container');
                answersContainer.innerHTML = '';
                
                question.answers.forEach((answer, aIndex) => {
                    const answerDiv = document.createElement('div');
                    answerDiv.className = 'answer-item';
                    answerDiv.dataset.index = aIndex;
                    
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    const escapedText = (answer.text || '').replace(/"/g, '&quot;');
                    const imageSrc = answer.image ? answer.image.replace(/"/g, '&quot;') : '';
                    
                    answerDiv.innerHTML = `
                        <input type="text" class="answer-text" placeholder="–¢–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞" value="${escapedText}">
                        <button class="remove-answer" onclick="removeAnswer(this)" type="button">–£–¥–∞–ª–∏—Ç—å</button>
                        <div class="file-input-wrapper">
                            <input type="file" class="answer-image-file" accept="image/*">
                            <img class="preview" style="display:${answer.image ? 'block' : 'none'};" src="${imageSrc}">
                            <button class="remove-img" style="display:${answer.image ? 'inline-block' : 'none'};" onclick="removeImage(this)" type="button">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                        </div>
                    `;
                    
                    const input = answerDiv.querySelector('.answer-image-file');
                    input.addEventListener('change', function() {
                        handleImageUpload(this);
                    });
                    
                    answersContainer.appendChild(answerDiv);
                });
                
                updateCorrectAnswerSelect(block);
                updateRemoveAnswerButtons(answersContainer);
                container.appendChild(block);
            });
        }

        let currentTest = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let showResultsMode = false;

        function startTest(index) {
            if (index < 0 || index >= tests.length) {
                alert('–¢–µ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            currentTest = tests[index];
            currentQuestionIndex = 0;
            userAnswers = [];
            showResultsMode = false;

            document.getElementById('test-list').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('create-form').style.display = 'none';

            renderQuestion();
            document.getElementById('quiz-section').style.display = 'block';
        }

        function renderQuestion() {
            if (!currentTest) return;
            
            const q = currentTest.questions[currentQuestionIndex];
            const total = currentTest.questions.length;

            let optionsHTML = '';
            q.answers.forEach((ans, i) => {
                const imgHTML = ans.image ? `<img src="${ans.image}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">` : '';
                const isChecked = (showResultsMode && userAnswers[currentQuestionIndex] === i) || (!showResultsMode && userAnswers[currentQuestionIndex] === i);
                optionsHTML += `
                    <label id="answer-label-${i}" class="answer-label">
                        <input type="radio" name="answer" value="${i}" ${isChecked ? 'checked' : ''} ${showResultsMode ? 'disabled' : ''} onchange="handleAnswerSelection(${q.correct}, ${i})">
                        <strong>${ans.text}</strong>
                        ${imgHTML}
                    </label>`;
            });

            document.getElementById('quiz-section').innerHTML = `
                <h2>${currentTest.title}</h2>
                <p><strong>–í–æ–ø—Ä–æ—Å ${currentQuestionIndex + 1} –∏–∑ ${total}</strong></p>
                <div class="quiz-question">
                    <h3>${q.text}</h3>
                    <div class="quiz-options">${optionsHTML}</div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="nextQuestion()" id="next-btn">${currentQuestionIndex < total - 1 ? '–î–∞–ª–µ–µ' : '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç'}</button>
                    <button onclick="finishTestEarly()" style="background: #f39c12; margin-left: 10px;">–ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ</button>
                    <button onclick="backToMainFromQuiz()" style="background: #95a5a6; margin-left: 10px;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
            if (showResultsMode && userAnswers[currentQuestionIndex] !== undefined) {
                setTimeout(() => highlightAnswers(q.correct, userAnswers[currentQuestionIndex]), 0);
            } else if (!showResultsMode && userAnswers[currentQuestionIndex] !== undefined) {
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
                setTimeout(() => highlightAnswers(q.correct, userAnswers[currentQuestionIndex]), 0);
            }
        }

        function handleAnswerSelection(correctIndex, selectedIndex) {
            if (!showResultsMode) {
                userAnswers[currentQuestionIndex] = selectedIndex;
                highlightAnswers(correctIndex, selectedIndex);
            }
        }

        function highlightAnswers(correctIndex, userIndex) {
            const allLabels = document.querySelectorAll('.quiz-options .answer-label');
            allLabels.forEach(label => {
                label.classList.remove('correct-answer', 'wrong-answer', 'show-correct');
            });

            const correctLabel = document.getElementById(`answer-label-${correctIndex}`);
            if (correctLabel) {
                correctLabel.classList.add('correct-answer', 'show-correct');
            }

            if (userIndex !== correctIndex && userIndex !== -1) {
                const userLabel = document.getElementById(`answer-label-${userIndex}`);
                if (userLabel) {
                    userLabel.classList.add('wrong-answer');
                }
            }
        }

        function nextQuestion() {
            const selected = document.querySelector('input[name="answer"]:checked');
            
            if (!showResultsMode) {
                if (userAnswers[currentQuestionIndex] === undefined) {
                    if (!selected) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç!');
                    userAnswers[currentQuestionIndex] = parseInt(selected.value);
                }
            }

            if (currentQuestionIndex < currentTest.questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else if (!showResultsMode) {
                showResults();
            } else {
                backToMainFromQuiz();
            }
        }

        function finishTestEarly() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç –¥–æ—Å—Ä–æ—á–Ω–æ? –ù–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –∑–∞—Å—á–∏—Ç–∞–Ω—ã –∫–∞–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ.')) {
                showResults();
            }
        }

        function showResults() {
            let score = 0;
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –∑–Ω–∞—á–µ–Ω–∏–µ–º -1 (–Ω–µ –æ—Ç–≤–µ—á–µ–Ω–æ)
            for (let i = 0; i < currentTest.questions.length; i++) {
                if (userAnswers[i] === undefined) {
                    userAnswers[i] = -1; // -1 –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–æ–ø—Ä–æ—Å –Ω–µ –±—ã–ª –æ—Ç–≤–µ—á–µ–Ω
                }
            }
            currentTest.questions.forEach((q, i) => {
                if (userAnswers[i] !== -1 && userAnswers[i] === q.correct) score++;
            });

            document.getElementById('quiz-section').innerHTML = `
                <div class="result">
                    <h2>–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
                    <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <strong>${score} –∏–∑ ${currentTest.questions.length}</strong></p>
                    <p>${score === currentTest.questions.length ? '–û—Ç–ª–∏—á–Ω–æ! –í—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ! üéâ' : 
                         score >= currentTest.questions.length * 0.7 ? '–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!' : '–ú–æ–∂–Ω–æ –ª—É—á—à–µ üòâ'}</p>
                    <div style="margin-top: 20px;">
                        <button onclick="reviewTest()">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
                        <button onclick="backToMainFromQuiz()" style="background: #95a5a6; margin-left: 10px;">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                    </div>
                </div>
            `;
        }

        function reviewTest() {
            showResultsMode = true;
            currentQuestionIndex = 0;
            renderQuestion();
        }

        function backToMainFromQuiz() {
            showResultsMode = false;
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('quiz-section').innerHTML = '';
            showMainPage();
        }
    </script>
</body>
</html>
